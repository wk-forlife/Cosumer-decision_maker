<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¶ˆè´¹å†³ç­–å™¨ Pro</title>
    <style>
        :root {
            --primary: #2563eb;
            --success: #16a34a;
            --warning: #ca8a04;
            --danger: #dc2626;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text: #0f172a;
        }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--text); padding: 20px; line-height: 1.5; max-width: 600px; margin: 0 auto; padding-bottom: 120px;}
        h1 { text-align: center; font-size: 1.4rem; margin-bottom: 5px; color: var(--primary); }
        .designed-by { text-align: center; font-size: 0.85rem; color: #64748b; margin-bottom: 15px;}
        
        /* Input Name */
        .item-name-input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #cbd5e1; border-radius: 8px; font-size: 1rem; box-sizing: border-box; }

        /* Tab Switching */
        .tabs { display: flex; margin-bottom: 15px; border-radius: 8px; overflow: hidden; border: 1px solid #cbd5e1; background: #e2e8f0; }
        .tab-btn { flex: 1; padding: 10px; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #64748b; transition: 0.2s; }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        .panel { display: none; }
        .panel.active { display: block; }

        /* Form Elements */
        .card { background: var(--card); padding: 15px 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .section-title { font-weight: 700; margin-bottom: 12px; font-size: 0.95rem; color: #334155; border-left: 4px solid var(--primary); padding-left: 8px; }
        
        .control-group { margin-bottom: 18px; }
        .label-row { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 0.9rem; font-weight: 600; }
        .desc-row { display: flex; justify-content: space-between; font-size: 0.75rem; color: #64748b; }
        
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 6px; background: #e2e8f0; border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 22px; height: 22px; border-radius: 50%; background: white; cursor: pointer; border: 2px solid var(--primary); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        
        /* Result Box - Fixed Bottom */
        .result-bar { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); padding: 10px 20px; box-shadow: 0 -4px 15px rgba(0,0,0,0.08); z-index: 100; display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; max-width: 600px; margin: 0 auto; border-top: 1px solid #e2e8f0; }
        .res-text { flex: 1; min-width: 120px; margin-bottom: 5px;}
        .score-display { font-size: 1.8rem; font-weight: 800; line-height: 1; color: var(--primary); }
        .verdict-display { font-size: 0.8rem; font-weight: 700; margin-top: 2px; }
        .score-hint { font-size: 0.7rem; color: #64748b; margin-top: 5px; } /* New Style for Hint */
        
        .action-group { display: flex; align-items: center; }
        #decisionSelect { padding: 8px; border-radius: 6px; border: 1px solid #ccc; font-size: 0.9rem; margin-right: 10px; }
        .save-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.9rem; }
        .save-btn:active { transform: scale(0.96); }

        /* History Section */
        .history-section { margin-top: 30px; border-top: 2px dashed #cbd5e1; padding-top: 20px; }
        .history-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .history-list { list-style: none; padding: 0; }
        .history-item { background: white; padding: 12px; margin-bottom: 10px; border-radius: 8px; font-size: 0.9rem; display: flex; justify-content: space-between; align-items: center; border-left: 5px solid #ccc; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .h-info { display: flex; flex-direction: column; }
        .h-name { font-weight: bold; font-size: 1rem; }
        .h-date { font-size: 0.75rem; color: #94a3b8; }
        .h-score { font-weight: bold; font-size: 1.1rem; text-align: right; margin-top: 4px;}
        .btn-clear { font-size: 0.8rem; color: #ef4444; background: none; border: 1px solid #ef4444; padding: 4px 8px; border-radius: 4px; cursor: pointer; }
        
        /* Editable Decision Styles */
        .h-decision-group { text-align: right; }
        .h-decision-select { padding: 3px 5px; border: 1px solid #ddd; border-radius: 4px; font-size: 0.75rem; background: #fff; cursor: pointer; font-weight: bold; max-width: 100px; }


        /* Dynamic Colors for Score/Verdict */
        .c-green { color: var(--success); } .b-green { border-color: var(--success); }
        .c-yellow { color: var(--warning); } .b-yellow { border-color: var(--warning); }
        .c-red { color: var(--danger); } .b-red { border-color: var(--danger); }
        
        /* Dynamic Colors for Final Decision (History Item Background) */
        .d-buy { border-left-color: var(--success) !important; }
        .d-wait { border-left-color: var(--warning) !important; }
        .d-stop { border-left-color: var(--danger) !important; }

        /* New Monthly Stats Card */
        .stats-card { background: var(--card); padding: 15px 20px; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); margin-bottom: 20px; border-top: 4px solid var(--primary); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
        .stat-item { border-right: 1px solid #e2e8f0; padding: 0 5px; }
        .stat-item:last-child { border-right: none; }
        .stat-label { font-size: 0.8rem; color: #64748b; font-weight: 600; margin-bottom: 4px; }
        .stat-amount { font-size: 1rem; font-weight: 700; line-height: 1.2;}
        .stat-count { font-size: 0.75rem; color: #94a3b8; }
        .stat-item.saved .stat-amount { color: var(--success); }
        .stat-item.impulse .stat-amount { color: var(--danger); }
        .stat-item.rational .stat-amount { color: var(--primary); }


        @media (max-width: 450px) {
            .result-bar { flex-direction: column; align-items: stretch; }
            .action-group { justify-content: space-between; margin-top: 10px; }
            #decisionSelect { flex: 1; margin-right: 5px; }
            .save-btn { flex: 1; }
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
        }
    </style>
</head>
<body>

    <h1>ğŸ§  æ¶ˆè´¹å†³ç­–å™¨ Pro</h1>
    <h2 class="designed-by">Designed by H.H</h2>
    
    <input type="text" id="itemName" class="item-name-input" placeholder="è¾“å…¥ä½ æƒ³ä¹°çš„ä¸œè¥¿ï¼ˆä¾‹å¦‚ï¼šiPhone 16ï¼‰...">

    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('elec')">ğŸ“± ç”µå­äº§å“</button>
        <button class="tab-btn" onclick="switchTab('cloth')">ğŸ‘” æœé¥°é‹åŒ…</button>
    </div>

    <div id="elec" class="panel active">
        <div class="card">
            <div class="section-title">ğŸ’° ä»·æ ¼ä¿¡æ¯</div>
            <div class="control-group">
                <div class="label-row"><span>é¡¹ç›®ä»·æ ¼ (å…ƒ)</span><span id="v-price-elec">0</span></div>
                <input type="range" min="0" max="10000" step="100" value="0" id="price-elec" oninput="updatePrice('elec')">
                <div class="desc-row"><span>0: å…è´¹/æä½</span><span>10000+: æé«˜</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">ä¸€ã€å¿…è¦æ€§ (35%)</div>
            <div class="control-group">
                <div class="label-row"><span>1. ä¸å¯æ›¿ä»£æ€§</span><span id="v-e1">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e1" oninput="calc()">
                <div class="desc-row"><span>0:é«˜ä¸å¯æ›¿ä»£æ€§(å¿…é¡»ä¹°)</span><span>5:ä½ä¸å¯æ›¿ä»£æ€§(å®Œå…¨èƒ½æ›¿ä»£)</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>2. ç´§æ€¥æ€§</span><span id="v-e2">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e2" oninput="calc()">
                <div class="desc-row"><span>0:ä¸¥é‡å½±å“å·¥ä½œ/ç”Ÿæ´»</span><span>5:å®Œå…¨ä¸å½±å“</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>3. ä½¿ç”¨é¢‘ç‡é¢„æœŸ</span><span id="v-e3">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e3" oninput="calc()">
                <div class="desc-row"><span>0:é«˜é¢‘ä½¿ç”¨</span><span>5:ä½é¢‘æˆ–ä¸ç¡®å®š</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">äºŒã€æˆæœ¬æ•ˆç›Š (35%)</div>
            <div class="control-group">
                <div class="label-row"><span>4. æ€§èƒ½æº¢ä»·</span><span id="v-e4">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e4" oninput="calc()">
                <div class="desc-row"><span>0:æå‡éå¸¸æ˜æ˜¾</span><span>5:æå‡æœ‰é™/æŒ¤ç‰™è†</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>5. ä»·æ ¼åˆç†æ€§</span><span id="v-e5">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e5" oninput="calc()">
                <div class="desc-row"><span>0:å†å²ä½ä½/æå…·æ€§ä»·æ¯”</span><span>5:æ˜æ˜¾åé«˜</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>6. æŠ˜æ—§é€Ÿåº¦</span><span id="v-e6">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e6" oninput="calc()">
                <div class="desc-row"><span>0:æŠ˜æ—§è¾ƒæ…¢/è€ç”¨</span><span>5:æŠ˜æ—§æå¿«/æ›´æ–°å¿«</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">ä¸‰ã€å¿ƒç†åŠ¨æœº (30%)</div>
            <div class="control-group">
                <div class="label-row"><span>7. å†²åŠ¨æ€§</span><span id="v-e7">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e7" oninput="calc()">
                <div class="desc-row"><span>0:å®Œå…¨åŸºäºéœ€æ±‚</span><span>5:å› æƒ…ç»ª/å‹åŠ›/æ— èŠè€Œæƒ³ä¹°</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>8. ç¤¾äº¤æ”€æ¯”/å†…å®¹ç§è‰å½±å“</span><span id="v-e8">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e8" oninput="calc()">
                <div class="desc-row"><span>0:å®Œå…¨è‡ªä¸»åˆ¤æ–­</span><span>5:è¢«å½±å“å¼º</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>9. å¦‚æœéœ€è¦åäº”å¤©åæ‰å‘è´§ æ˜¯å¦æ„¿æ„è´­ä¹°</span><span id="v-e9">0</span></div>
                <input type="range" min="0" max="5" value="0" id="e9" oninput="calc()">
                <div class="desc-row"><span>0:è‚¯å®šä¼šï¼ˆçœŸå®éœ€æ±‚ï¼‰</span><span>5:å¤§æ¦‚ç‡ä¸ä¼šï¼ˆå†·é™æœŸæœ‰æ•ˆï¼‰</span></div>
            </div>
        </div>
    </div>

    <div id="cloth" class="panel">
        <div class="card">
            <div class="section-title">ğŸ’° ä»·æ ¼ä¿¡æ¯</div>
            <div class="control-group">
                <div class="label-row"><span>é¡¹ç›®ä»·æ ¼ (å…ƒ)</span><span id="v-price-cloth">0</span></div>
                <input type="range" min="0" max="10000" step="100" value="0" id="price-cloth" oninput="updatePrice('cloth')">
                <div class="desc-row"><span>0: å…è´¹/æä½</span><span>10000+: æé«˜</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">ä¸€ã€å®ç”¨æ€§ (40%)</div>
            <div class="control-group">
                <div class="label-row"><span>1. åœºæ™¯éœ€æ±‚</span><span id="v-c1">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c1" oninput="calc()">
                <div class="desc-row"><span>0:å¾ˆéœ€è¦ç”¨äºç‰¹å®šåœºæ™¯</span><span>5:ä¸éœ€è¦ç”¨äºç‰¹å®šåœºæ™¯</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>2. åŠŸèƒ½æ€§</span><span id="v-c2">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c2" oninput="calc()">
                <div class="desc-row"><span>0:åŠŸèƒ½åˆšéœ€ï¼ˆå¦‚ä¿æš–ã€é˜²æ°´ï¼‰</span><span>5:ä¸æä¾›åŠŸèƒ½åˆšéœ€</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>3. é‡å¤åº¦</span><span id="v-c3">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c3" oninput="calc()">
                <div class="desc-row"><span>0:å®Œå…¨æ²¡æœ‰æ›¿ä»£å“</span><span>5:å·²æœ‰å¤šä»¶ç±»ä¼¼</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">äºŒã€è´¨é‡ä¸ç”Ÿå‘½å‘¨æœŸ (30%)</div>
            <div class="control-group">
                <div class="label-row"><span>4. è´¨é‡å¯é æ€§</span><span id="v-c4">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c4" oninput="calc()">
                <div class="desc-row"><span>0:è´¨é‡å¾ˆä¼˜ç§€/è€ç©¿</span><span>5:æ™®é€šæˆ–ä¸€èˆ¬</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>5. é€‚é…åº¦</span><span id="v-c5">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c5" oninput="calc()">
                <div class="desc-row"><span>0:éå¸¸å¥‘åˆï¼ˆèº«æã€é£æ ¼ï¼‰</span><span>5:ä¸€èˆ¬æˆ–ä¸ç¡®å®š</span></div>
            </div>
        </div>
        <div class="card">
            <div class="section-title">ä¸‰ã€å¿ƒç†ä¸è´¢åŠ¡ (30%)</div>
            <div class="control-group">
                <div class="label-row"><span>6. å†²åŠ¨æ€§</span><span id="v-c6">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c6" oninput="calc()">
                <div class="desc-row"><span>0:å®Œå…¨ç†æ€§é©±åŠ¨</span><span>5:æºäºçŸ­æœŸæƒ…ç»ªæˆ–æŠ˜æ‰£</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>7. é¢„ç®—å‹åŠ›</span><span id="v-c7">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c7" oninput="calc()">
                <div class="desc-row"><span>0:ä¸å½±å“å‚¨è“„è®¡åˆ’</span><span>5:æ˜æ˜¾æŒ¤å‹å‚¨è“„</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>8. ç©¿ç€é¢‘ç‡é¢„æœŸ</span><span id="v-c8">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c8" oninput="calc()">
                <div class="desc-row"><span>0:é¢‘ç¹ç©¿</span><span>5:å¾ˆå°‘ç©¿</span></div>
            </div>
            <div class="control-group">
                <div class="label-row"><span>9. å¦‚æœéœ€è¦åäº”å¤©åæ‰å‘è´§ æ˜¯å¦æ„¿æ„è´­ä¹°</span><span id="v-c9">0</span></div>
                <input type="range" min="0" max="5" value="0" id="c9" oninput="calc()">
                <div class="desc-row"><span>0:è‚¯å®šä¼šï¼ˆçœŸå®éœ€æ±‚ï¼‰</span><span>5:å¤§æ¦‚ç‡ä¸ä¼šï¼ˆå†·é™æœŸæœ‰æ•ˆï¼‰</span></div>
            </div>
        </div>
    </div>
    
    <div class="stats-card">
        <div class="section-title">ğŸ“Š æœ¬æœˆæ¶ˆè´¹æ¦‚è§ˆ (<span id="currentMonth"></span>)</div>
        <div class="stats-grid">
            <div class="stat-item saved">
                <div class="stat-label">å·²çœ (ç¬”æ•°)</div>
                <div class="stat-amount" id="savedCount">0</div>
                <div class="stat-count" id="savedAmount">Â¥0</div>
            </div>
            <div class="stat-item impulse">
                <div class="stat-label">å†²åŠ¨æ¶ˆè´¹ (ç¬”æ•°)</div>
                <div class="stat-amount" id="impulseCount">0</div>
                <div class="stat-count" id="impulseAmount">Â¥0</div>
            </div>
            <div class="stat-item rational">
                <div class="stat-label">åˆç†æ¶ˆè´¹ (ç¬”æ•°)</div>
                <div class="stat-amount" id="rationalCount">0</div>
                <div class="stat-count" id="rationalAmount">Â¥0</div>
            </div>
        </div>
    </div>
    <div class="history-section">
        <div class="history-header">
            <h3>ğŸ“œ è¯„ä¼°å†å²</h3>
            <button class="btn-clear" onclick="clearHistory()">æ¸…ç©ºè®°å½•</button>
        </div>
        <ul id="historyList" class="history-list">
            </ul>
    </div>

    <div class="result-bar" id="resultBar">
        <div class="res-text">
            <div class="score-display" id="totalScore">0.0</div>
            <div class="verdict-display" id="verdictText">è®¡ç®—ä¸­...</div>
            <div class="score-hint">*å¾—åˆ†è¶Šé«˜ï¼Œè¶Šä¸å»ºè®®è´­ä¹°</div>
        </div>
        <div class="action-group">
            <select id="decisionSelect">
                <option value="stop">æˆ‘ä¸ä¹°äº†</option>
                <option value="wait">æˆ‘ç­‰ç­‰çœ‹</option>
                <option value="buy">æˆ‘è¿˜æ˜¯è¦å‰æ‰‹</option>
            </select>
            <button class="save-btn" onclick="saveResult()">ğŸ’¾ ä¿å­˜å¹¶è®°å½•</button>
        </div>
    </div>

<script>
    let currentTab = 'elec';
    let currentScore = 0;
    let currentVerdict = "";
    let colorClass = "";

    const clothSection3Items = 4;
    const currentMonth = new Date().getMonth(); // 0-11
    const currentYear = new Date().getFullYear();

    // æ›´æ–°æœˆä»½æ˜¾ç¤º
    document.getElementById('currentMonth').innerText = `${currentYear}å¹´${currentMonth + 1}æœˆ`;

    function switchTab(tab) {
        currentTab = tab;
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tab).classList.add('active');
        const btns = document.querySelectorAll('.tab-btn');
        if(tab === 'elec') btns[0].classList.add('active');
        else btns[1].classList.add('active');
        calc();
        updatePrice(tab);
    }
    
    // æ›´æ–°ä»·æ ¼æ˜¾ç¤ºå¹¶è¿”å›ä»·æ ¼æ•°å€¼
    function updatePrice(tab) {
        const priceId = 'price-' + tab;
        const valueId = 'v-price-' + tab;
        const priceInput = document.getElementById(priceId);
        if (priceInput) {
            const priceValue = parseInt(priceInput.value);
            document.getElementById(valueId).innerText = priceValue.toLocaleString();
            return priceValue;
        }
        return 0;
    }

    function getVal(id) {
        let v = parseInt(document.getElementById(id).value);
        document.getElementById('v-'+id).innerText = v;
        return v;
    }

    function calc() {
        if(currentTab === 'elec') {
            // E-Scale: S1:35%, S2:35%, S3:30% (3 items each)
            let s1 = (getVal('e1') + getVal('e2') + getVal('e3')) / 3 * 0.35;
            let s2 = (getVal('e4') + getVal('e5') + getVal('e6')) / 3 * 0.35;
            let s3 = (getVal('e7') + getVal('e8') + getVal('e9')) / 3 * 0.30;
            currentScore = s1 + s2 + s3;
        } else {
            // C-Scale: S1:40% (3 items), S2:30% (2 items), S3:30% (4 items)
            let s1 = (getVal('c1') + getVal('c2') + getVal('c3')) / 3 * 0.40;
            let s2 = (getVal('c4') + getVal('c5')) / 2 * 0.30;
            let s3_sum = getVal('c6') + getVal('c7') + getVal('c8') + getVal('c9');
            let s3 = (s3_sum / clothSection3Items) * 0.30;
            currentScore = s1 + s2 + s3;
        }
        updateUI();
    }

    function updateUI() {
        const scoreEl = document.getElementById('totalScore');
        const textEl = document.getElementById('verdictText');

        scoreEl.innerText = currentScore.toFixed(1);

        let threshold1 = (currentTab === 'elec') ? 1.5 : 1.2;
        let threshold2 = (currentTab === 'elec') ? 3.0 : 2.5;

        scoreEl.classList.remove('c-green', 'c-yellow', 'c-red');
        textEl.classList.remove('c-green', 'c-yellow', 'c-red');

        if (currentScore <= threshold1) {
            currentVerdict = "âœ… å»ºè®®è´­ä¹°";
            colorClass = "b-green";
            scoreEl.classList.add('c-green');
            textEl.classList.add('c-green');
        } else if (currentScore <= threshold2) {
            currentVerdict = "â³ å»¶è¿Ÿ 15 å¤©";
            colorClass = "b-yellow";
            scoreEl.classList.add('c-yellow');
            textEl.classList.add('c-yellow');
        } else {
            currentVerdict = "ğŸ›‘ ä¸è¦ä¹°ï¼";
            colorClass = "b-red";
            scoreEl.classList.add('c-red');
            textEl.classList.add('c-red');
        }
        textEl.innerText = currentVerdict;
    }

    // --- History & Stats Functions ---

    function getDecisionText(value) {
        switch(value) {
            case 'buy': return { text: 'æˆ‘è¿˜æ˜¯è¦å‰æ‰‹', class: 'd-buy', value: 'buy' };
            case 'wait': return { text: 'æˆ‘ç­‰ç­‰çœ‹', class: 'd-wait', value: 'wait' };
            case 'stop': return { text: 'æˆ‘ä¸ä¹°äº†', class: 'd-stop', value: 'stop' };
            default: return { text: 'æˆ‘ä¸ä¹°äº†', class: 'd-stop', value: 'stop' }; 
        }
    }

    // è®¡ç®—æœˆåº¦ç»Ÿè®¡ (åŸºäºä½ å®šä¹‰çš„å¤æ‚é€»è¾‘)
    function calculateMonthlyStats() {
        let history = JSON.parse(localStorage.getItem('shopHistory') || "[]");
        
        let stats = {
            savedCount: 0, savedAmount: 0,
            impulseCount: 0, impulseAmount: 0,
            rationalCount: 0, rationalAmount: 0,
        };

        history.forEach(item => {
            const recordDate = new Date(item.id);
            // åªç»Ÿè®¡æœ¬æœˆè®°å½•
            if (recordDate.getMonth() === currentMonth && recordDate.getFullYear() === currentYear) {
                // priceStoredæ˜¯å¸¦é€—å·çš„å­—ç¬¦ä¸²ï¼Œè½¬å›æ•°å­—
                const priceValue = parseInt(String(item.price).replace(/,/g, '')); 
                
                // 1. å·²çœ (Saved): æœ€ç»ˆå†³ç­–æ˜¯ "æˆ‘ä¸ä¹°äº†" (stop) æˆ– "æˆ‘ç­‰ç­‰çœ‹" (wait)
                if (item.decisionValue === 'stop' || item.decisionValue === 'wait') {
                    stats.savedCount++;
                    stats.savedAmount += priceValue;
                } 
                
                // 2. å†²åŠ¨æ¶ˆè´¹ (Impulse): Verdictæ˜¯ "ä¸è¦ä¹°" æˆ– "å»¶è¿Ÿ 15 å¤©" ä¸” æœ€ç»ˆå†³ç­–æ˜¯ "æˆ‘è¿˜æ˜¯è¦å‰æ‰‹" (buy)
                else if (item.decisionValue === 'buy' && 
                         (item.verdict === 'ğŸ›‘ ä¸è¦ä¹°ï¼' || item.verdict === 'â³ å»¶è¿Ÿ 15 å¤©')) {
                    stats.impulseCount++;
                    stats.impulseAmount += priceValue;
                } 
                
                // 3. åˆç†æ¶ˆè´¹ (Rational): Verdictæ˜¯ "å»ºè®®è´­ä¹°" ä¸” æœ€ç»ˆå†³ç­–æ˜¯ "æˆ‘è¿˜æ˜¯è¦å‰æ‰‹" (buy)
                else if (item.decisionValue === 'buy' && item.verdict === 'âœ… å»ºè®®è´­ä¹°') {
                    stats.rationalCount++;
                    stats.rationalAmount += priceValue;
                }
                // å…¶ä»–æƒ…å†µï¼ˆå¦‚æ•°æ®æŸåæˆ–æ„å¤–å€¼ï¼‰åˆ™ä¸è®¡å…¥ç»Ÿè®¡
            }
        });

        // æ›´æ–° UI
        document.getElementById('savedCount').innerText = stats.savedCount;
        document.getElementById('savedAmount').innerText = `Â¥${stats.savedAmount.toLocaleString()}`;
        document.getElementById('impulseCount').innerText = stats.impulseCount;
        document.getElementById('impulseAmount').innerText = `Â¥${stats.impulseAmount.toLocaleString()}`;
        document.getElementById('rationalCount').innerText = stats.rationalCount;
        document.getElementById('rationalAmount').innerText = `Â¥${stats.rationalAmount.toLocaleString()}`;
    }


    function saveResult() {
        const nameInput = document.getElementById('itemName');
        const decisionSelectElement = document.getElementById('decisionSelect');
        
        if (nameInput.value.trim() === '') {
            alert("è¯·è¾“å…¥è´­ä¹°é¡¹ç›®åç§°ï¼");
            nameInput.focus();
            return;
        }
        
        // è·å–å½“å‰ä»·æ ¼ (æ•°å€¼)
        const currentPriceValue = updatePrice(currentTab);

        const name = nameInput.value.trim();
        const finalDecisionValue = decisionSelectElement.value;
        const decisionInfo = getDecisionText(finalDecisionValue);
        
        const record = {
            id: Date.now(),
            name: name,
            score: currentScore.toFixed(1),
            verdict: currentVerdict,
            color: colorClass,
            finalDecision: decisionInfo.text,
            decisionValue: decisionInfo.value, 
            decisionClass: decisionInfo.class,
            price: currentPriceValue.toLocaleString(), // ä¿å­˜æ ¼å¼åŒ–çš„ä»·æ ¼
            date: new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: 'numeric', day: 'numeric' }) + " " + new Date().toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', hour12: false })
        };

        let history = JSON.parse(localStorage.getItem('shopHistory') || "[]");
        history.unshift(record);
        localStorage.setItem('shopHistory', JSON.stringify(history));
        
        renderHistory();
        calculateMonthlyStats(); // ä¿å­˜åæ›´æ–°ç»Ÿè®¡
        
        // Visual feedback and reset
        const btn = document.querySelector('.save-btn');
        let oldText = btn.innerText;
        btn.innerText = "å·²ä¿å­˜ï¼";
        setTimeout(() => { btn.innerText = oldText; }, 1500);
        nameInput.value = ''; 
        decisionSelectElement.value = 'stop'; // é‡ç½®ä¸º 'æˆ‘ä¸ä¹°äº†'
        
        // é‡ç½®ä»·æ ¼è¾“å…¥æ¡†çš„å€¼
        document.getElementById('price-elec').value = 0;
        document.getElementById('v-price-elec').innerText = 0;
        document.getElementById('price-cloth').value = 0;
        document.getElementById('v-price-cloth').innerText = 0;
    }
    
    // æ›´æ–°å†å²è®°å½•çš„å†³ç­– (æ ¸å¿ƒå˜åŠ¨ç‚¹ï¼Œå·²åŒ…å«æ›´æ–°ç»Ÿè®¡çš„è°ƒç”¨)
    function updateDecision(selectElement) {
        const id = parseInt(selectElement.id.replace('decision-select-', ''));
        const newValue = selectElement.value;
        const decisionInfo = getDecisionText(newValue);
        
        let history = JSON.parse(localStorage.getItem('shopHistory') || "[]");
        
        const index = history.findIndex(item => item.id === id);
        
        if (index > -1) {
            history[index].finalDecision = decisionInfo.text;
            history[index].decisionValue = decisionInfo.value;
            history[index].decisionClass = decisionInfo.class;
            
            localStorage.setItem('shopHistory', JSON.stringify(history));
            
            // Re-render the list to update the visual feedback on the list item border
            renderHistory();
            calculateMonthlyStats(); // ã€æ­¤å¤„ç¡®ä¿äº†æ›´æ–°ç»Ÿè®¡ã€‘
        }
    }

    function renderHistory() {
        const list = document.getElementById('historyList');
        let history = JSON.parse(localStorage.getItem('shopHistory') || "[]");
        
        if (history.length === 0) {
            list.innerHTML = `<li style="text-align: center; color: #94a3b8; margin-top: 20px;">æš‚æ— è¯„ä¼°è®°å½•ã€‚å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡è¯„ä¼°å§ï¼</li>`;
            return;
        }

        list.innerHTML = history.map(item => `
            <li class="history-item ${item.decisionClass}">
                <div class="h-info">
                    <span class="h-name">${item.name}</span>
                    <span class="h-date">${item.date} | ä»·æ ¼: Â¥${item.price} | è¯„ä¼°åˆ†ï¼š${item.score} (${item.verdict})</span>
                </div>
                <div class="h-decision-group">
                    <select id="decision-select-${item.id}" class="h-decision-select" onchange="updateDecision(this)">
                        <option value="stop" ${item.decisionValue === 'stop' ? 'selected' : ''}>æˆ‘ä¸ä¹°äº†</option>
                        <option value="wait" ${item.decisionValue === 'wait' ? 'selected' : ''}>æˆ‘ç­‰ç­‰çœ‹</option>
                        <option value="buy" ${item.decisionValue === 'buy' ? 'selected' : ''}>æˆ‘è¿˜æ˜¯è¦å‰æ‰‹</option>
                    </select>
                </div>
            </li>
        `).join('');
    }

    function clearHistory() {
        if(confirm("ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
            localStorage.removeItem('shopHistory');
            renderHistory();
            calculateMonthlyStats(); // æ¸…ç©ºåæ›´æ–°ç»Ÿè®¡
        }
    }

    // Init
    calc();
    updatePrice('elec'); 
    updatePrice('cloth');
    renderHistory();
    calculateMonthlyStats(); // é¡µé¢åŠ è½½æ—¶è®¡ç®—å¹¶æ˜¾ç¤ºç»Ÿè®¡
</script>

</body>
</html>
